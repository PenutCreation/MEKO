<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.jsdelivr.net/gh/PenutCreation/SERVER-MEKO-HYPERZ.G5z/DATABASEPOSTS.js?v=1001"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meko</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="https://penutcreation.github.io/MEKO/og-image.jpg">
<!-- Basic SEO -->
<meta name="description" content="Meko â€” a Safe Haven Social Media.">

<!-- Open Graph / Facebook -->
<meta property="og:title" content="Meko - Share and React, Share your Videos and
Support">
<meta property="og:description" content="A Safe Haven Social Media and Help
others ">
<meta property="og:image"
content="https://penutcreation.github.io/MEKO/og-image.jpg">
<meta property="og:url" content="https://penutcreation.github.io/MEKO/">
<meta property="og:type" content="website">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Meko - Share and React, Share your Videos and
Support">
<meta name="twitter:description" content="Connect with friends and the world around you">
<meta name="twitter:image"
content="https://penutcreation.github.io/MEKO/og-image.jpg">
</head>
<style>
/* Simplified Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Theme Variables */
:root {
    /* Dark Theme (Default) */
    --bg-primary: #0a0e17;
    --bg-secondary: #1a1f2e;
    --bg-card: #252a3a;
    --text-primary: #ffffff;
    --text-secondary: #b0b3b8;
    --text-muted: #8a8d91;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --border: #2d3243;
    --shadow: rgba(0, 0, 0, 0.3);
    --danger: #ef4444;
    --success: #10b981;
    --overlay: rgba(0, 0, 0, 0.7);
}

.light-mode {
    /* Light Theme */
    --bg-primary: #ffffff;
    --bg-secondary: #f7f9fc;
    --bg-card: #ffffff;
    --text-primary: #1a1a1a;
    --text-secondary: #65676b;
    --text-muted: #8a8d91;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --border: #e4e6eb;
    --shadow: rgba(0, 0, 0, 0.1);
    --danger: #dc2626;
    --success: #059669;
    --overlay: rgba(0, 0, 0, 0.5);
}

/* Base Styles */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.5;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
    overflow-x: hidden;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--overlay);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-secondary);
    border-radius: 12px;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px var(--shadow);
}

.auth-modal {
    max-width: 400px;
}

.profile-modal {
    max-width: 800px;
}

/* Auth Modal */
.auth-header {
    padding: 2rem;
    text-align: center;
    background: linear-gradient(135deg, var(--accent), #1e40af);
    color: white;
    border-radius: 12px 12px 0 0;
}

.logo {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.auth-subtitle {
    font-size: 0.95rem;
    opacity: 0.9;
    font-weight: 400;
}

.auth-tabs {
    display: flex;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border);
}

.auth-tab {
    flex: 1;
    padding: 1rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.auth-tab.active {
    color: var(--accent);
    border-bottom: 3px solid var(--accent);
}

.auth-form {
    padding: 2rem;
    display: none;
}

.auth-form.active {
    display: block;
}

.form-group {
    margin-bottom: 1.25rem;
    position: relative;
}

.form-group i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
}

.auth-form input {
    width: 100%;
    padding: 0.875rem 1rem 0.875rem 2.75rem;
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 1rem;
    transition: border-color 0.3s;
}

.auth-form input:focus {
    outline: none;
    border-color: var(--accent);
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 1.25rem 0;
    font-size: 0.9rem;
}

.checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.checkbox input {
    width: auto;
}

.forgot-link {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}

.btn {
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background: var(--border);
}

.btn-block {
    width: 100%;
}

.auth-divider {
    text-align: center;
    margin: 1.5rem 0;
    position: relative;
}

.auth-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--border);
}

.auth-divider span {
    background: var(--bg-secondary);
    padding: 0 1rem;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.auth-footer {
    padding: 1.5rem 2rem;
    border-top: 1px solid var(--border);
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.auth-footer a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}

.error-message {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
}

/* Main App */
.app-container {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Header */
.header {
    background: var(--bg-secondary);
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid var(--border);
    height: 64px;
}

.logo-container {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.logo {
    font-size: 1.5rem;
    background: linear-gradient(135deg, var(--accent), #60a5fa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.beta-tag {
    background: var(--accent);
    color: white;
    font-size: 0.7rem;
    padding: 0.125rem 0.5rem;
    border-radius: 10px;
    font-weight: 600;
}

/* Search Container */
.search-container {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    max-width: 600px;
}

.search-bar {
    flex: 1;
    position: relative;
    display: none;
}

.search-bar.active {
    display: block;
}

.search-bar input {
    width: 100%;
    padding: 0.625rem 1rem 0.625rem 2.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 20px;
    color: var(--text-primary);
    font-size: 0.95rem;
}

.search-bar i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 0.9rem;
}

.search-toggle {
    display: none;
}

/* Header Actions */
.header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
}

.btn-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-radius: 50%;
    font-size: 1.1rem;
    position: relative;
    transition: background 0.3s;
}

.btn-icon:hover {
    background: var(--bg-card);
}

.mobile-menu-toggle {
    display: none;
}

.badge {
    position: absolute;
    top: -2px;
    right: -2px;
    background: var(--danger);
    color: white;
    font-size: 0.7rem;
    padding: 0.125rem 0.375rem;
    border-radius: 50%;
    min-width: 18px;
    text-align: center;
}

/* User Menu */
.user-menu {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
}

.user-avatar img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    object-fit: cover;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    min-width: 180px;
    display: none;
    z-index: 1000;
    margin-top: 0.5rem;
    box-shadow: 0 5px 15px var(--shadow);
}

.dropdown-menu.active {
    display: block;
}

.dropdown-menu a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1rem;
    color: var(--text-primary);
    text-decoration: none;
    border-bottom: 1px solid var(--border);
    transition: background 0.3s;
}

.dropdown-menu a:last-child {
    border-bottom: none;
}

.dropdown-menu a:hover {
    background: var(--bg-card);
}

/* Main Content */
.main-content {
    flex: 1;
    display: flex;
    padding: 1rem;
    gap: 1rem;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    padding-bottom: 60px;
}

/* Sidebars */
.sidebar {
    width: 240px;
    display: none;
}

.left-sidebar,
.right-sidebar {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 1.25rem;
    height: fit-content;
    position: sticky;
    top: 80px;
}

/* Navigation Menu */
.nav-menu {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-bottom: 2rem;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s;
}

.nav-item:hover {
    background: var(--bg-card);
    color: var(--text-primary);
}

.nav-item.active {
    background: var(--accent);
    color: white;
}

/* Trending & Suggestions */
.trending-section,
.search-history,
.suggested-profiles {
    margin-bottom: 2rem;
}

.trending-section h3,
.search-history h3,
.suggested-profiles h3 {
    font-size: 1rem;
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-weight: 600;
}

.trending-list,
.history-list,
.profiles-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.trending-item,
.history-item,
.profile-item {
    padding: 0.75rem;
    background: var(--bg-card);
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
}

.trending-item:hover,
.history-item:hover,
.profile-item:hover {
    background: var(--accent);
    color: white;
}

.profile-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.profile-item img {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
}

.profile-info h4 {
    font-size: 0.9rem;
    margin-bottom: 0.125rem;
}

.profile-info span {
    font-size: 0.8rem;
    color: var(--text-muted);
}

/* Feed Container */
.feed-container {
    flex: 1;
    max-width: 600px;
    width: 100%;
}

/* Create Post Box */
.create-post-box {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1rem;
}

.post-input-container {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
}

.user-avatar-small img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    object-fit: cover;
}

.post-input-wrapper {
    flex: 1;
}

.post-input-wrapper textarea {
    width: 100%;
    padding: 1rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text-primary);
    font-size: 1rem;
    resize: vertical;
    min-height: 80px;
    margin-bottom: 1rem;
    font-family: inherit;
}

.post-input-wrapper textarea:focus {
    outline: none;
    border-color: var(--accent);
}

.media-options {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.media-btn {
    padding: 0.625rem 1rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
}

.media-btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

.post-actions {
    display: flex;
    gap: 0.75rem;
    align-items: center;
}

#postTopic {
    flex: 1;
    padding: 0.625rem 1rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.9rem;
    min-width: 120px;
}

.media-preview {
    margin-top: 1rem;
    padding: 1rem;
    background: var(--bg-card);
    border-radius: 8px;
    border: 2px dashed var(--border);
    display: none;
}

.media-preview.active {
    display: block;
}

/* Posts Feed */
.posts-feed {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.post-card {
    background: var(--bg-secondary);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid var(--border);
}

.post-header {
    padding: 1.25rem 1.25rem 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.post-user {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    cursor: pointer;
    flex: 1;
    min-width: 0;
}

.post-user img {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    object-fit: cover;
    flex-shrink: 0;
}

.user-info {
    min-width: 0;
}

.user-info h3 {
    font-size: 1rem;
    margin-bottom: 0.125rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.user-info span {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.post-date {
    font-size: 0.85rem;
    color: var(--text-muted);
    flex-shrink: 0;
}

.post-content {
    padding: 0 1.25rem 1.25rem;
}

.post-content p {
    margin-bottom: 1rem;
    line-height: 1.6;
}

.post-media {
    margin: 1rem 0;
}

.post-media img {
    width: 100%;
    max-height: 500px;
    object-fit: cover;
    border-radius: 8px;
}

.post-media video {
    width: 100%;
    max-height: 500px;
    border-radius: 8px;
    background: #000;
}

.post-iframe {
    width: 100%;
    aspect-ratio: 16/9;
    border: none;
    border-radius: 8px;
}

.post-stats {
    padding: 1rem 1.25rem;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.post-actions-buttons {
    padding: 0 1.25rem 1.25rem;
    display: flex;
    gap: 1.5rem;
}

.action-btn {
    padding: 0.5rem 0.75rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    border-radius: 6px;
    transition: all 0.3s;
}

.action-btn:hover {
    background: var(--bg-card);
    color: var(--text-primary);
}

.action-btn.liked {
    color: var(--danger);
}

.action-btn.liked:hover {
    color: var(--danger);
}

.load-more {
    padding: 2rem 1rem;
    text-align: center;
}

/* Search Results */
.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-top: 0.5rem;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
    box-shadow: 0 5px 15px var(--shadow);
}

.search-section {
    border-bottom: 1px solid var(--border);
}

.search-section:last-child {
    border-bottom: none;
}

.search-section-header {
    padding: 0.75rem 1rem;
    background: var(--bg-card);
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.search-result-item {
    padding: 1rem;
    display: flex;
    align-items: flex-start;
    gap: 0.875rem;
    cursor: pointer;
    border-bottom: 1px solid var(--border);
    transition: background 0.3s;
}

.search-result-item:hover {
    background: var(--accent);
    color: white;
}

.search-result-item:hover .search-result-info h4,
.search-result-item:hover .search-result-info span,
.search-result-item:hover .search-result-info .search-result-content,
.search-result-item:hover .search-result-info .search-result-meta {
    color: white;
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.topic-icon,
.post-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.post-icon {
    background: var(--success);
}

.search-result-info {
    flex: 1;
    min-width: 0;
}

.search-result-info h4 {
    font-size: 0.95rem;
    margin-bottom: 0.125rem;
    color: var(--text-primary);
}

.search-result-info span {
    font-size: 0.8rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 0.25rem;
}

.search-result-content {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin: 0.25rem 0;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.search-result-meta {
    font-size: 0.75rem;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

/* Mobile Menu */
.mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100%;
    background: var(--bg-secondary);
    transform: translateX(-100%);
    transition: transform 0.3s;
    z-index: 1100;
    overflow-y: auto;
}

.mobile-menu.active {
    transform: translateX(0);
}

.mobile-menu-header {
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid var(--border);
}

.close-menu {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.close-menu:hover {
    background: var(--bg-card);
}

.mobile-nav {
    padding: 0.5rem 0;
}

.mobile-nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    color: var(--text-primary);
    text-decoration: none;
    border-bottom: 1px solid var(--border);
    transition: background 0.3s;
}

.mobile-nav-item.active {
    background: var(--accent);
    color: white;
}

.mobile-nav-item:hover:not(.active) {
    background: var(--bg-card);
}

.mobile-menu-footer {
    padding: 1.25rem;
    border-top: 1px solid var(--border);
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    display: flex;
    justify-content: space-around;
    padding: 0.5rem;
    border-top: 1px solid var(--border);
    z-index: 100;
}

.bottom-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.75rem;
    gap: 0.25rem;
    position: relative;
    padding: 0.5rem;
    min-width: 60px;
    transition: color 0.3s;
}

.bottom-nav-item.active {
    color: var(--accent);
}

.bottom-nav-item .fa-plus-circle {
    font-size: 1.75rem;
    color: var(--accent);
    margin-top: -0.25rem;
}

/* Profile Header */
.profile-header {
    padding: 2rem;
    text-align: center;
    background: linear-gradient(135deg, var(--accent), #1e40af);
    color: white;
}

.profile-avatar img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid white;
    object-fit: cover;
    margin-bottom: 1rem;
}

.profile-stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin: 1.5rem 0;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    display: block;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.profile-username {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 0.5rem;
}

.joined-date {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Modal Styles */
.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
}

.close-modal {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.close-modal:hover {
    background: var(--bg-card);
}

.modal-body {
    padding: 1.5rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .sidebar {
        width: 200px;
    }
    
    .feed-container {
        max-width: 500px;
    }
}

@media (max-width: 768px) {
    /* Header Adjustments */
    .header {
        padding: 0.5rem;
        gap: 0.5rem;
        height: 60px;
    }
    
    .logo {
        font-size: 1.25rem;
    }
    
    .search-container {
        position: static;
    }
    
    .search-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        z-index: 1001;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border-bottom: 1px solid var(--border);
    }
    
    .search-bar.active {
        display: flex;
    }
    
    .search-bar input {
        flex: 1;
        padding: 0.75rem 1rem 0.75rem 2.75rem;
        border-radius: 20px;
    }
    
    .search-toggle {
        display: flex;
    }
    
    .mobile-menu-toggle {
        display: flex;
    }
    
    /* Hide desktop elements */
    .sidebar,
    .dropdown-menu {
        display: none !important;
    }
    
    /* Main content */
    .main-content {
        padding: 0.75rem;
        gap: 0;
        padding-bottom: 60px;
    }
    
    .feed-container {
        max-width: 100%;
    }
    
    .create-post-box {
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .post-input-container {
        gap: 0.75rem;
    }
    
    .media-options {
        gap: 0.5rem;
    }
    
    .media-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
    }
    
    .media-label {
        display: none;
    }
    
    .post-actions {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
    }
    
    #postTopic {
        min-width: 100%;
    }
    
    /* Posts adjustments */
    .post-header {
        padding: 1rem 1rem 0.5rem;
    }
    
    .post-content {
        padding: 0 1rem 1rem;
    }
    
    .post-stats {
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
    }
    
    .post-actions-buttons {
        padding: 0 1rem 1rem;
        gap: 1rem;
    }
    
    .action-btn {
        font-size: 0.9rem;
        padding: 0.5rem;
    }
    
    /* Bottom nav adjustments */
    .bottom-nav {
        display: flex;
    }
}

@media (min-width: 769px) {
    .mobile-menu-toggle,
    .mobile-menu,
    .bottom-nav {
        display: none;
    }
    
    .sidebar {
        display: block;
    }
    
    .search-toggle {
        display: none;
    }
    
    .search-bar {
        display: block !important;
    }
}

/* Utilities */
.hidden {
    display: none !important;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* Loading Animation */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 2rem auto;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-muted);
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.empty-state p {
    font-size: 0.95rem;
    max-width: 300px;
    margin: 0 auto;
}


/* Add to style.css */
.mention {
    color: var(--accent);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.mention:hover {
    text-decoration: underline;
    background-color: rgba(59, 130, 246, 0.1);
    border-radius: 3px;
    padding: 0 2px;
}

.mentions-info {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-left: 1rem;
}

.mention-you {
    color: var(--success);
    font-weight: 600;
    font-size: 0.9rem;
    margin-left: 1rem;
    background-color: rgba(16, 185, 129, 0.1);
    padding: 2px 6px;
    border-radius: 12px;
}

// Add this CSS for profile tabs:
/* Add to style.css */
.profile-tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    margin: 0 1.25rem;
}

.profile-tab {
    flex: 1;
    padding: 1rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
}

.profile-tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
}

.tab-content {
    display: none;
    padding: 1rem;
}

.tab-content.active {
    display: block;
}
</style>
<body class="dark-mode">
    <!-- Login/Signup Modal -->
    <div class="modal active" id="authModal">
        <div class="modal-content auth-modal">
            <div class="auth-header">
                <h1 class="logo">Meko</h1>
                <p class="auth-subtitle">Connect with friends and the world around you</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Log In</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <input type="text" id="loginUsername" placeholder="Username" required>
                    <i class="fas fa-user"></i>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <i class="fas fa-lock"></i>
                </div>
                <div class="form-options">
                    <label class="checkbox">
                        <input type="checkbox" id="rememberMe">
                        <span>Remember me</span>
                    </label>
                    <a href="#" class="forgot-link">Forgot password?</a>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Log In</button>
                <div class="auth-divider">
                    <span>or</span>
                </div>
                <button type="button" class="btn btn-secondary btn-block" id="createNewAccount">
                    Create New Account
                </button>
            </form>
            
            <!-- Signup Form -->
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <input type="text" id="signupName" placeholder="Full Name" required>
                    <i class="fas fa-user"></i>
                </div>
                <div class="form-group">
                    <input type="text" id="signupUsername" placeholder="Username" required>
                    <i class="fas fa-at"></i>
                    <small class="error-message" id="usernameError"></small>
                </div>
                <div class="form-group">
                    <input type="email" id="signupEmail" placeholder="Email Address" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="form-group">
                    <input type="password" id="signupPassword" placeholder="Password" required>
                    <i class="fas fa-lock"></i>
                </div>
                <div class="form-group">
                    <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required>
                    <i class="fas fa-lock"></i>
                </div>
                <div class="form-options">
                    <label class="checkbox">
                        <input type="checkbox" id="termsAgree" required>
                        <span>I agree to the <a href="#">Terms & Conditions</a></span>
                    </label>
                </div>
                <div class="error-message" id="loginError" style="display: none;"></div>
                <button type="submit" class="btn btn-primary btn-block">Sign Up</button>
            </form>
            
            <div class="auth-footer">
                <p>By continuing, you agree to Meko's <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
            </div>
        </div>
    </div>

    <!-- Main App (Initially Hidden) -->
    <div class="app-container hidden">
        <!-- Header -->
        <header class="header">
            <!-- Left: Logo -->
            <div class="logo-container">
                <h1 class="logo">Meko</h1>
                <span class="beta-tag">Beta</span>
            </div>
            
            <!-- Center: Search Bar -->
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search profiles, topics, or posts...">
                    <div class="search-results" id="searchResults">
                        <!-- Search results will appear here -->
                    </div>
                </div>
                <button class="btn-icon search-toggle" id="searchToggle">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <!-- Right: Actions -->
            <div class="header-actions">
                <div class="theme-toggle">
                    <button class="btn-icon" id="themeToggleBtn" title="Toggle Theme">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                </div>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar">
                        <img src="https://ui-avatars.com/api/?name=Guest&background=1e3a8a&color=fff" alt="Profile">
                    </div>
                    <button class="btn-icon" id="menuToggle">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="userMenu">
                        <a href="#" id="profileLink"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" id="settingsLink"><i class="fas fa-cog"></i> Settings</a>
                        <a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Menu Button -->
            <button class="btn-icon mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <div class="user-avatar">
                    <img src="https://ui-avatars.com/api/?name=Guest&background=1e3a8a&color=fff" alt="Profile">
                </div>
                <div class="user-info">
                    <h3 id="mobileUserName">Guest</h3>
                    <span id="mobileUserUsername">@guest</span>
                </div>
                <button class="close-menu" id="closeMobileMenu">&times;</button>
            </div>
            <div class="mobile-nav">
                <a href="#" class="mobile-nav-item active" id="mobileHomeLink">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileProfileLink">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileFriendsLink">
                    <i class="fas fa-users"></i>
                    <span>Friends</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileWatchLink">
                    <i class="fas fa-video"></i>
                    <span>Watch</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileSettingsLink">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileLogoutLink">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Sidebar (Desktop) -->
            <aside class="sidebar left-sidebar">
                <nav class="nav-menu">
                    <a href="#" class="nav-item active" id="desktopHomeLink">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#" class="nav-item" id="desktopProfileLink">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                    <a href="#" class="nav-item" id="desktopFriendsLink">
                        <i class="fas fa-users"></i>
                        <span>Friends</span>
                    </a>
                    <a href="#" class="nav-item" id="desktopWatchLink">
                        <i class="fas fa-video"></i>
                        <span>Watch</span>
                    </a>
                </nav>
                
                <div class="trending-section">
                    <h3>Trending Now</h3>
                    <div class="trending-list" id="trendingList">
                        <!-- Trending topics will be loaded here -->
                    </div>
                </div>
            </aside>

            <!-- Feed Area -->
            <div class="feed-container">
                <!-- Create Post Box -->
                <div hidden="" class="create-post-box" id="createPostBox">
                    <div class="post-input-container">
                        <div class="user-avatar-small">
                            <img id="currentUserAvatar" src="https://ui-avatars.com/api/?name=Guest&background=1e3a8a&color=fff" alt="You">
                        </div>
                        <div class="post-input-wrapper">
                            <textarea id="postContent" placeholder="What's on your mind?" rows="2"></textarea>
                            <div class="post-options">
                                <div class="media-options">
                                    <button type="button" class="media-btn" data-type="image">
                                        <i class="fas fa-image"></i>
                                        <span class="media-label">Photo</span>
                                    </button>
                                    <button type="button" class="media-btn" data-type="video">
                                        <i class="fas fa-video"></i>
                                        <span class="media-label">Video</span>
                                    </button>
                                    <button type="button" class="media-btn" data-type="iframe">
                                        <i class="fab fa-youtube"></i>
                                        <span class="media-label">Link</span>
                                    </button>
                                </div>
                                <div class="post-actions">
                                    <input type="text" id="postTopic" placeholder="Topic (optional)">
                                    <button class="btn btn-primary" id="submitPostBtn">Post</button>
                                </div>
                            </div>
                            <div class="media-preview" id="mediaPreview"></div>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <input type="file" id="videoUpload" accept="video/*" style="display: none;">
                            <input type="text" id="linkInput" placeholder="Paste YouTube/Facebook link" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Posts Feed -->
                <div class="posts-feed" id="postsFeed">
                    <!-- Posts will be loaded here -->
                </div>

                <!-- Load More -->
                <div class="load-more" id="loadMore">
                    <button class="btn btn-secondary" id="loadMoreBtn">
                        <i class="fas fa-sync-alt"></i> Load More Posts
                    </button>
                </div>
            </div>

            <!-- Right Sidebar (Desktop) -->
            <aside class="sidebar right-sidebar">
                <div class="search-history">
                    <h3>Recent Searches</h3>
                    <div class="history-list" id="searchHistory">
                        <!-- Search history will appear here -->
                    </div>
                </div>
                
                <div class="suggested-profiles">
                    <h3>Suggested Profiles</h3>
                    <div class="profiles-list" id="suggestedProfiles">
                        <!-- Suggested profiles will be loaded here -->
                    </div>
                </div>
            </aside>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <a href="#" class="bottom-nav-item active" id="bottomHomeBtn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="bottom-nav-item" id="bottomSearchBtn">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </a>
            <a href="#" class="bottom-nav-item" id="bottomProfileBtn">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </nav>

        <!-- Profile Modal -->
        <div class="modal" id="profileModal">
            <div class="modal-content profile-modal">
                <div class="modal-header">
                    <h2 id="profileName"></h2>
                    <button class="close-modal" id="closeProfileModal">&times;</button>
                </div>
                <div class="profile-header" id="profileHeader">
                    <!-- Profile header will be loaded here -->
                </div>
                <div class="profile-posts" id="profilePosts">
                    <!-- User's posts will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Post Creation Modal -->
        <div class="modal" id="postModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Create New Post</h2>
                    <button class="close-modal" id="closePostModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <textarea id="postContentModal" placeholder="What's on your mind?" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Add Media (Optional)</label>
                        <div class="media-buttons">
                            <button type="button" class="btn btn-secondary" id="addImageBtn">
                                <i class="fas fa-image"></i> Image
                            </button>
                            <button type="button" class="btn btn-secondary" id="addVideoBtn">
                                <i class="fas fa-video"></i> Video
                            </button>
                            <button type="button" class="btn btn-secondary" id="addLinkBtn">
                                <i class="fas fa-link"></i> YouTube/Facebook Link
                            </button>
                        </div>
                        <div class="media-preview-modal" id="mediaPreviewModal"></div>
                    </div>
                    <div class="form-group">
                        <input type="text" id="postTopicModal" placeholder="Topic (optional)">
                    </div>
                    <button class="btn btn-primary btn-block" id="submitNewPostBtn">Post</button>
                </div>
            </div>
        </div>
    </div>


<script>
document.onkeydown = function(e) {
    if (e.key == "F12" ||
        (e.ctrlKey && e.shiftKey && e.key == "I") ||
        (e.ctrlKey && e.shiftKey && e.key == "J") ||
        (e.ctrlKey && e.key == "U")
    ) {
        return false;
    }
};
</script>
<script>
setInterval(() => {
    const element = new Image();
    element.__defineGetter__("id", function () {
        window.location.href = "about:blank"; 
    });
    console.log(element);
}, 1000);
</script>
<script>
// main.js
// Global variables
let currentUser = null;
let postsPerPage = 5;
let currentPage = 0;
let currentMediaType = null;
let allPosts = [];
let displayedPosts = new Set();

// DOM Elements
const elements = {
    // Auth elements
    authModal: document.getElementById('authModal'),
    loginForm: document.getElementById('loginForm'),
    signupForm: document.getElementById('signupForm'),
    authTabs: document.querySelectorAll('.auth-tab'),
    loginUsername: document.getElementById('loginUsername'),
    loginPassword: document.getElementById('loginPassword'),
    signupName: document.getElementById('signupName'),
    signupUsername: document.getElementById('signupUsername'),
    signupEmail: document.getElementById('signupEmail'),
    signupPassword: document.getElementById('signupPassword'),
    signupConfirmPassword: document.getElementById('signupConfirmPassword'),
    usernameError: document.getElementById('usernameError'),
    createNewAccount: document.getElementById('createNewAccount'),
    loginError: document.getElementById('loginError'),
    
    // Main app elements
    appContainer: document.querySelector('.app-container'),
    postsFeed: document.getElementById('postsFeed'),
    searchInput: document.getElementById('searchInput'),
    searchResults: document.getElementById('searchResults'),
    searchToggle: document.getElementById('searchToggle'),
    themeToggleBtn: document.getElementById('themeToggleBtn'),
    themeIcon: document.getElementById('themeIcon'),
    createPostBtn: document.getElementById('createPostBtn'),
    submitPostBtn: document.getElementById('submitPostBtn'),
    loadMoreBtn: document.getElementById('loadMoreBtn'),
    profileModal: document.getElementById('profileModal'),
    postModal: document.getElementById('postModal'),
    closeProfileModal: document.getElementById('closeProfileModal'),
    closePostModal: document.getElementById('closePostModal'),
    searchHistory: document.getElementById('searchHistory'),
    suggestedProfiles: document.getElementById('suggestedProfiles'),
    trendingList: document.getElementById('trendingList'),
    postContent: document.getElementById('postContent'),
    mediaPreview: document.getElementById('mediaPreview'),
    imageUpload: document.getElementById('imageUpload'),
    videoUpload: document.getElementById('videoUpload'),
    linkInput: document.getElementById('linkInput'),
    postTopic: document.getElementById('postTopic'),
    postContentModal: document.getElementById('postContentModal'),
    postTopicModal: document.getElementById('postTopicModal'),
    mediaPreviewModal: document.getElementById('mediaPreviewModal'),
    submitNewPostBtn: document.getElementById('submitNewPostBtn'),
    addImageBtn: document.getElementById('addImageBtn'),
    addVideoBtn: document.getElementById('addVideoBtn'),
    addLinkBtn: document.getElementById('addLinkBtn'),
    
    // Mobile elements
    mobileMenuToggle: document.getElementById('mobileMenuToggle'),
    mobileMenu: document.getElementById('mobileMenu'),
    closeMobileMenu: document.getElementById('closeMobileMenu'),
    mobileUserName: document.getElementById('mobileUserName'),
    mobileUserUsername: document.getElementById('mobileUserUsername'),
    mobileProfileLink: document.getElementById('mobileProfileLink'),
    mobileLogoutLink: document.getElementById('mobileLogoutLink'),
    createPostMobile: document.getElementById('createPostMobile'),
    bottomSearchBtn: document.getElementById('bottomSearchBtn'),
    bottomCreatePostBtn: document.getElementById('bottomCreatePostBtn'),
    bottomProfileBtn: document.getElementById('bottomProfileBtn'),
    
    // User menu elements
    userMenu: document.getElementById('userMenu'),
    menuToggle: document.getElementById('menuToggle'),
    profileLink: document.getElementById('profileLink'),
    logoutLink: document.getElementById('logoutLink'),
    currentUserAvatar: document.getElementById('currentUserAvatar'),
    userAvatar: document.querySelector('#userAvatar img')
};

// Store all registered users in localStorage
const USERS_KEY = 'meko-registered-users';
const CURRENT_USER_KEY = 'meko-current-user';

// Initialize the app
function init() {
    // Initialize users storage if empty
    if (!localStorage.getItem(USERS_KEY)) {
        localStorage.setItem(USERS_KEY, JSON.stringify({}));
    }
    
    checkAuth();
    setupEventListeners();
    initializePosts();
    loadTrendingTopics();
    loadSuggestedProfiles();
    setupTheme();
}

// Get all registered users
function getRegisteredUsers() {
    const users = localStorage.getItem(USERS_KEY);
    return users ? JSON.parse(users) : {};
}

// Save a user
function saveUser(username, userData) {
    const users = getRegisteredUsers();
    users[username] = userData;
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

// Check if username exists in posts database OR registered users
function isUsernameTaken(username) {
    const users = getRegisteredUsers();
    
    // Check in registered users
    if (users[username]) {
        return true;
    }
    
    // Check in posts database (as per your requirement)
    return DATABASEPOSTS.some(post => post.username === username);
}
// main.js - Update checkAuth() function around line 641
// main.js - Update checkAuth function
function checkAuth() {
    const savedUser = localStorage.getItem(CURRENT_USER_KEY);
    
    if (savedUser) {
        try {
            const parsedUser = JSON.parse(savedUser);
            
            // Convert arrays back to Sets
            currentUser = {
                ...parsedUser,
                likedPosts: new Set(parsedUser.likedPosts || []),
                followedTopics: new Set(parsedUser.followedTopics || []),
                isGuest: false
            };
            
            console.log('User automatically logged in:', currentUser.username);
            
            // Initialize posts
            initializePosts();
            
            // Hide auth modal, show app
            hideAuthModal();
            
            updateUserUI();
            loadPosts();
            loadSearchHistory();
            
            return true;
        } catch (e) {
            console.error('Error parsing user data:', e);
            localStorage.removeItem(CURRENT_USER_KEY);
        }
    }
    
    // No user or error - show auth modal
    showAuthModal();
    
    // Set default guest user
    currentUser = {
        name: "Guest",
        username: "guest",
        email: "",
        likedPosts: new Set(),
        searchHistory: [],
        followedTopics: new Set(),
        isGuest: true
    };
    
    // Initialize posts for guest too
    initializePosts();
    
    return false;
}

function showAuthModal() {
    if (elements.authModal) {
        elements.authModal.classList.add('active');
    }
    if (elements.appContainer) {
        elements.appContainer.classList.add('hidden');
    }
}

function hideAuthModal() {
    if (elements.authModal) {
        elements.authModal.classList.remove('active');
    }
    if (elements.appContainer) {
        elements.appContainer.classList.remove('hidden');
    }
}

// Save current user to localStorage
// main.js - Update saveCurrentUser function
function saveCurrentUser() {
    if (currentUser && !currentUser.isGuest) {
        // Convert Sets to Arrays for localStorage
        const userToSave = {
            ...currentUser,
            likedPosts: currentUser.likedPosts ? Array.from(currentUser.likedPosts) : [],
            followedTopics: currentUser.followedTopics ? Array.from(currentUser.followedTopics) : []
        };
        
        localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userToSave));
        
        // Also update the user in registered users storage
        const users = getRegisteredUsers();
        if (users[currentUser.username]) {
            users[currentUser.username] = {
                ...users[currentUser.username],
                likedPosts: userToSave.likedPosts,
                searchHistory: userToSave.searchHistory,
                followedTopics: userToSave.followedTopics
            };
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
        }
    }
}
// Setup event listeners
function setupEventListeners() {
    // Auth event listeners
    if (elements.authTabs) {
        elements.authTabs.forEach(tab => {
            tab.addEventListener('click', switchAuthTab);
        });
    }
    
    if (elements.loginForm) {
        elements.loginForm.addEventListener('submit', handleLogin);
    }
    
    if (elements.signupForm) {
        elements.signupForm.addEventListener('submit',handleSignup);
    }
    
    if (elements.createNewAccount) {
        elements.createNewAccount.addEventListener('click', () => {
            document.querySelector('.auth-tab[data-tab="signup"]').click();
        });
    }
    
    // Theme toggle
    if (elements.themeToggleBtn) {
        elements.themeToggleBtn.addEventListener('click', toggleTheme);
    }
    
    // Search functionality
    if (elements.searchInput) {
        elements.searchInput.addEventListener('input', handleSearch);
        elements.searchInput.addEventListener('focus', showSearchResults);
    }
    
    if (elements.searchToggle) {
        elements.searchToggle.addEventListener('click', toggleSearchBar);
    }
    
    if (elements.bottomSearchBtn) {
        elements.bottomSearchBtn.addEventListener('click', toggleSearchBar);
    }
    
    // Post creation
    if (elements.createPostBtn) {
        elements.createPostBtn.addEventListener('click', () => showPostModal());
    }
    
    if (elements.submitPostBtn) {
        elements.submitPostBtn.addEventListener('click', createPost);
    }
    
    if (elements.submitNewPostBtn) {
        elements.submitNewPostBtn.addEventListener('click', createNewPost);
    }
    
    if (elements.createPostMobile) {
        elements.createPostMobile.addEventListener('click', () => showPostModal());
    }
    
    if (elements.bottomCreatePostBtn) {
        elements.bottomCreatePostBtn.addEventListener('click', () => showPostModal());
    }
    
    // Modal controls
    if (elements.closeProfileModal) {
        elements.closeProfileModal.addEventListener('click', () => {
            elements.profileModal.classList.remove('active');
        });
    }
    
    if (elements.closePostModal) {
        elements.closePostModal.addEventListener('click', () => {
            elements.postModal.classList.remove('active');
            resetPostForm();
        });
    }
    
    // Load more posts
    if (elements.loadMoreBtn) {
        elements.loadMoreBtn.addEventListener('click', loadMorePosts);
    }
    
    // Media buttons
    document.querySelectorAll('.media-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const type = btn.dataset.type;
            handleMediaButtonClick(type);
        });
    });
    // In setupEventListeners() function, update these parts:

// Profile links - OWN PROFILE
if (elements.profileLink) {
    elements.profileLink.addEventListener('click', (e) => {
        e.preventDefault();
        showOwnProfile(); // Changed from showUserProfile()
    });
}

if (elements.mobileProfileLink) {
    elements.mobileProfileLink.addEventListener('click', (e) => {
        e.preventDefault();
        showOwnProfile(); // Changed from showUserProfile()
        closeMobileMenu();
    });
}

if (elements.bottomProfileBtn) {
    elements.bottomProfileBtn.addEventListener('click', (e) => {
        e.preventDefault();
        showOwnProfile(); // Changed from showUserProfile()
    });
}

// Also update desktop sidebar profile link
const desktopProfileLink = document.getElementById('desktopProfileLink');
if (desktopProfileLink) {
    desktopProfileLink.addEventListener('click', (e) => {
        e.preventDefault();
        showOwnProfile();
    });
}
    // Media buttons in modal
    if (elements.addImageBtn) {
        elements.addImageBtn.addEventListener('click', () => addMediaToPost('image'));
    }
    
    if (elements.addVideoBtn) {
        elements.addVideoBtn.addEventListener('click', () => addMediaToPost('video'));
    }
    
    if (elements.addLinkBtn) {
        elements.addLinkBtn.addEventListener('click', () => addMediaToPost('iframe'));
    }
    
    // Mobile menu
    if (elements.mobileMenuToggle) {
        elements.mobileMenuToggle.addEventListener('click', openMobileMenu);
    }
    
    if (elements.closeMobileMenu) {
        elements.closeMobileMenu.addEventListener('click', closeMobileMenu);
    }
    
    // User menu
    if (elements.menuToggle) {
        elements.menuToggle.addEventListener('click', toggleUserMenu);
    }
    
    if (elements.logoutLink) {
        elements.logoutLink.addEventListener('click', handleLogout);
    }
    
    if (elements.mobileLogoutLink) {
        elements.mobileLogoutLink.addEventListener('click', handleLogout);
    }
    
    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
        if (elements.profileModal && e.target === elements.profileModal) {
            elements.profileModal.classList.remove('active');
        }
        if (elements.postModal && e.target === elements.postModal) {
            elements.postModal.classList.remove('active');
            resetPostForm();
        }
        
        // Close user menu if clicking outside
        if (elements.userMenu && !elements.userMenu.contains(e.target) && e.target !== elements.menuToggle) {
            elements.userMenu.classList.remove('active');
        }
        
        // Close search results if clicking outside
        if (elements.searchResults && !elements.searchResults.contains(e.target) && e.target !== elements.searchInput) {
            elements.searchResults.style.display = 'none';
        }
    });
    
    // Close search on escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (elements.searchResults) {
                elements.searchResults.style.display = 'none';
            }
            document.querySelector('.search-bar')?.classList.remove('active');
        }
    });
}

// Auth functions
function switchAuthTab(e) {
    const tab = e.target;
    const tabName = tab.dataset.tab;
    
    // Update active tab
    elements.authTabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    
    // Show corresponding form
    document.querySelectorAll('.auth-form').forEach(form => {
        form.classList.remove('active');
    });
    document.getElementById(`${tabName}Form`).classList.add('active');
    
    // Clear errors
    if (elements.usernameError) elements.usernameError.style.display = 'none';
    if (elements.loginError) elements.loginError.style.display = 'none';
}
// main.js - Update the handleLogin function
function handleLogin(e) {
    e.preventDefault();
    
    const username = elements.loginUsername.value.trim().toLowerCase();
    const password = elements.loginPassword.value.trim();
    
    // Clear previous error
    if (elements.loginError) {
        elements.loginError.style.display = 'none';
        elements.loginError.textContent = '';
    }
    
    // Validation
    if (!username || !password) {
        if (elements.loginError) {
            elements.loginError.textContent = 'Please fill in all fields';
            elements.loginError.style.display = 'block';
        }
        return;
    }
    
    // Get registered users
    const users = getRegisteredUsers();
    
    // Check if user exists
    if (!users[username]) {
        if (elements.loginError) {
            elements.loginError.textContent = 'Account not found. Please sign up first.';
            elements.loginError.style.display = 'block';
        }
        return;
    }
    
    // Check password (in real app, this would be hashed)
    if (users[username].password !== password) {
        if (elements.loginError) {
            elements.loginError.textContent = 'Wrong password. Please try again.';
            elements.loginError.style.display = 'block';
        }
        return;
    }
    
    // Login successful - GET USER DATA FROM STORAGE
    const userData = users[username];
    
    // Convert arrays back to Sets
    const likedPosts = new Set(userData.likedPosts || []);
    const followedTopics = new Set(userData.followedTopics || []);
    
    currentUser = {
        name: userData.name,
        username: username,
        email: userData.email,
        likedPosts: likedPosts,
        searchHistory: userData.searchHistory || [],
        followedTopics: followedTopics,
        isGuest: false
    };
    
    // Save to localStorage - USER STAYS LOGGED IN!
    saveCurrentUser();
    
    // Update the registered user data with current data
    saveUser(username, {
        ...userData,
        likedPosts: Array.from(likedPosts),
        searchHistory: currentUser.searchHistory,
        followedTopics: Array.from(followedTopics)
    });
    
    // Re-initialize posts for this user (new randomization)
    initializePosts();
    
    // Hide auth modal, show app
    hideAuthModal();
    
    // Update UI
    updateUserUI();
    loadPosts(); // Load posts after login
    loadSearchHistory();
    
    // Clear form
    if (elements.loginForm) elements.loginForm.reset();
}
// main.js - Update handleSignup function
function handleSignup(e) {
    e.preventDefault();
    
    const name = elements.signupName.value.trim();
    const username = elements.signupUsername.value.trim().toLowerCase();
    const email = elements.signupEmail.value.trim();
    const password = elements.signupPassword.value.trim();
    const confirmPassword = elements.signupConfirmPassword.value.trim();
    
    // Clear previous error
    if (elements.usernameError) elements.usernameError.style.display = 'none';
    
    // Validation
    if (!name || !username || !email || !password || !confirmPassword) {
        alert('Please fill in all fields');
        return;
    }
    
    if (password !== confirmPassword) {
        alert('Passwords do not match');
        return;
    }
    
    if (password.length < 6) {
        alert('Password must be at least 6 characters');
        return;
    }
    
    // Check if username already exists (in posts OR registered users)
    if (isUsernameTaken(username)) {
        if (elements.usernameError) {
            elements.usernameError.textContent = 'This username is already taken.';
            elements.usernameError.style.display = 'block';
        }
        return;
    }
    
    // Create user data
    const userData = {
        name: name,
        email: email,
        password: password, // In real app, this would be hashed
        likedPosts: [],
        searchHistory: [],
        followedTopics: [],
        createdAt: new Date().toISOString()
    };
    
    // Save user to registered users
    saveUser(username, userData);
    
    // Set as current user
    currentUser = {
        name: name,
        username: username,
        email: email,
        likedPosts: new Set(),
        searchHistory: [],
        followedTopics: new Set(),
        isGuest: false
    };
    
    // Save to localStorage - USER STAYS LOGGED IN!
    saveCurrentUser();
    
    // Initialize posts (randomized)
    initializePosts();
    
    // Hide auth modal, show app
    hideAuthModal();
    
    // Update UI
    updateUserUI();
    loadPosts(); // Load posts after signup
    
    // Clear form
    if (elements.signupForm) elements.signupForm.reset();
    
    // Switch to login tab (for next time)
    const loginTab = document.querySelector('.auth-tab[data-tab="login"]');
    if (loginTab) loginTab.click();
}
function updateUserUI() {
    if (!currentUser) return;
    
    // Update avatar
    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=1e3a8a&color=fff&bold=true`;
    
    if (elements.currentUserAvatar) {
        elements.currentUserAvatar.src = avatarUrl;
    }
    
    if (elements.userAvatar) {
        elements.userAvatar.src = avatarUrl;
    }
    
    // Update mobile menu
    if (elements.mobileUserName) {
        elements.mobileUserName.textContent = currentUser.name;
    }
    
    if (elements.mobileUserUsername) {
        elements.mobileUserUsername.textContent = `@${currentUser.username}`;
    }
    
    // Update mobile menu avatar
    const mobileAvatar = elements.mobileMenu?.querySelector('.user-avatar img');
    if (mobileAvatar) mobileAvatar.src = avatarUrl;
}

function handleLogout(e) {
    if (e) e.preventDefault();
    
    // Clear current user data
    localStorage.removeItem(CURRENT_USER_KEY);
    currentUser = null;
    
    // Show auth modal, hide app
    showAuthModal();
    
    // Reset forms
    if (elements.loginForm) elements.loginForm.reset();
    if (elements.signupForm) elements.signupForm.reset();
    
    // Clear errors
    if (elements.usernameError) elements.usernameError.style.display = 'none';
    if (elements.loginError) elements.loginError.style.display = 'none';
    
    // Switch to login tab
    const loginTab = document.querySelector('.auth-tab[data-tab="login"]');
    if (loginTab) loginTab.click();
    
    // Clear feed
    if (elements.postsFeed) elements.postsFeed.innerHTML = '';
    displayedPosts.clear();
    currentPage = 0;
    
    // Set default guest user
    currentUser = {
        name: "Guest",
        username: "guest",
        email: "",
        likedPosts: new Set(),
        searchHistory: [],
        followedTopics: new Set(),
        isGuest: true
    };
    
    // Update UI for guest
    updateUserUI();
}

// main.js - Update initializePosts() function
function initializePosts() {
    // Create a copy of all posts and reverse them (newest first)
    allPosts = [...DATABASEPOSTS].reverse();
    
    // Generate unique seed for each load - randomizes every time!
    const seed = Date.now() + Math.random();
    
    // Shuffle posts using Fisher-Yates algorithm with unique seed
    allPosts = shuffleArray(allPosts, seed);
    
    // Add IDs to posts (from bottom to top as specified)
    allPosts.forEach((post, index) => {
        post.id = allPosts.length - index; // ID from bottom to top
    });
    
    console.log(`Loaded ${allPosts.length} posts with seed: ${seed}`);
}

// main.js - Update lines 130-140
// Seeded random number generator
function seededRandom(seed) {
    let x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
}

// Fisher-Yates shuffle with seed
function shuffleArray(array, seed) {
    const shuffled = [...array];
    const randomFunc = seededRandom(seed); // Renamed to avoid conflict
    
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(randomFunc * (i + 1)); // Use randomFunc
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    
    return shuffled;
}
// Post loading and rendering
function loadPosts() {
    if (!elements.postsFeed) return;
    
    const startIndex = currentPage * postsPerPage;
    const endIndex = startIndex + postsPerPage;
    
    // Get posts that haven't been displayed yet
    const postsToShow = allPosts
        .filter(post => !displayedPosts.has(post.id))
        .slice(startIndex, endIndex);
    
    if (postsToShow.length === 0) {
        if (elements.loadMoreBtn) {
            elements.loadMoreBtn.textContent = 'No more posts';
            elements.loadMoreBtn.disabled = true;
        }
        return;
    }
    
    postsToShow.forEach(post => {
        const postElement = createPostElement(post, post.id);
        elements.postsFeed.appendChild(postElement);
        displayedPosts.add(post.id);
    });
    
    currentPage++;
}

function loadMorePosts() {
    loadPosts();
}
function createPostElement(post, postId) {
    const postElement = document.createElement('div');
    postElement.className = 'post-card';
    postElement.dataset.postId = postId;
    postElement.dataset.topic = post.topic || '';
    
    // Parse and format date from "Dec 11 2025 3:02AM" format
    const postDate = parseCustomDate(post.datePost);
    const formattedDate = formatDateToCustom(postDate);
    
    // Create user profile from posts data
    const userPosts = DATABASEPOSTS.filter(p => p.username === post.username);
    const totalLikes = userPosts.reduce((sum, p) => sum + p.likes, 0);
    const postsCount = userPosts.length;
    
    // Get user's first post date as joined date
    const firstPost = userPosts[userPosts.length - 1];
    const joinedDate = firstPost ? formatJoinedDate(parseCustomDate(firstPost.datePost)) : 'Recently';
    
    // Check for mentions in post content
    let mentionedUsers = [];
    let processedContent = post.content || '';
    
    if (post.content) {
        // Find all @mentions in the content
        const mentionRegex = /@(\w+)/g;
        let match;
        mentionedUsers = [];
        
        while ((match = mentionRegex.exec(post.content)) !== null) {
            mentionedUsers.push(match[1]); // Get username without @
        }
        
        // Highlight mentions in the content
        processedContent = post.content.replace(/@(\w+)/g, 
            '<span class="mention" data-username="$1">@$1</span>'
        );
    }
    
    // Check if this post mentions the logged-in user
    const mentionsCurrentUser = currentUser && !currentUser.isGuest && 
                                mentionedUsers.includes(currentUser.username);
    
    // 1. SET INNER HTML (YOUR TEMPLATE)
    postElement.innerHTML = `
        <div class="post-header">
            <div class="post-user" data-username="${post.username}">
                <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(post.name)}&background=1e3a8a&color=fff" alt="${post.name}">
                <div class="user-info">
                    <h3>${post.name}</h3>
                    <span>@${post.username}</span>
                </div>
            </div>
            <div class="post-date">${formattedDate}</div>
        </div>
        <div class="post-content">
            ${processedContent ? `<p>${processedContent}</p>` : ''}
            ${renderMediaContent(post)}
        </div>
        <div class="post-stats">
            <span>${post.likes.toLocaleString()} likes</span>
            ${mentionedUsers.length > 0 ? `<span class="mentions-info">Mentions ${mentionedUsers.length} user${mentionedUsers.length > 1 ? 's' : ''}</span>` : ''}
            ${mentionsCurrentUser ? `<span class="mention-you">Mentions you!</span>` : ''}
        </div>
        <div class="post-actions-buttons">
            <button class="action-btn ${currentUser?.likedPosts?.has(postId) ? 'liked' : ''}" data-action="like" data-post-id="${postId}">
                <i class="fas fa-heart"></i> Like
            </button>
        </div>
    `;
    
    // 2. FIND THE VIDEO AND ATTACH OBSERVER
    // This targets the video element using the class defined in renderMediaContent
    const videoElement = postElement.querySelector('.auto-pause-video');
    
    if (videoElement) {
        // Assume 'postVideoObserver' is the global IntersectionObserver instance from the previous step.
        // Start observing this specific video element immediately.
        // The callback logic handles the play/pause when it scrolls in/out of view.
        if (typeof postVideoObserver !== 'undefined') {
            postVideoObserver.observe(videoElement);
        } else {
            console.error("postVideoObserver is not defined! Ensure the global observer setup code runs first.");
        }
    }
    
    // 3. Add other event listeners
    const likeBtn = postElement.querySelector('[data-action="like"]');
    if (likeBtn) {
        likeBtn.addEventListener('click', () => handleLike(postId, likeBtn));
    }
    
    const userInfo = postElement.querySelector('.post-user');
    if (userInfo) {
        userInfo.addEventListener('click', () => showUserProfile(post.username, post.name));
    }
    
    // Add click handlers for mentions
    postElement.querySelectorAll('.mention').forEach(mention => {
        mention.addEventListener('click', (e) => {
            e.stopPropagation();
            const username = mention.dataset.username;
            
            // Check if mentioned user exists in database
            const userExists = DATABASEPOSTS.some(p => p.username === username);
            if (userExists) {
                showUserProfile(username, username);
            } else {
                alert(`User @${username} not found`);
            }
        });
    });
    
    return postElement;
}



// Add this function to track and display mentions for a user
function getMentionsForUser(username) {
    const userMentions = [];
    
    // Go through all posts (from bottom to top)
    for (let i = 0; i < DATABASEPOSTS.length; i++) {
        const post = DATABASEPOSTS[i];
        const postId = DATABASEPOSTS.length - i; // ID from bottom to top
        
        if (post.content && post.content.includes(`@${username}`)) {
            userMentions.push({
                postId: postId,
                post: post,
                datePost: parseCustomDate(post.datePost),
                mentionedBy: post.username,
                topic: post.topic || '',
                positionInArray: i // Lower number = older post
            });
        }
    }
    
    // Sort mentions by date (newest first)
    userMentions.sort((a, b) => b.datePost - a.datePost);
    
    return userMentions;
}

function renderMediaContent(post) {
    if (post.iframe) {
        // Iframes are typically handled differently, but we can add the auto-pause logic to the video inside the iframe (if you control it)
        // or apply the class to the iframe itself if it can be paused via external API (which is rare).
        // For now, only the video tag is modified.
        return `<div class="post-media"><iframe class="post-iframe" src="${post.iframe}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
    } else if (post.video) {
        return `<div class="post-media">
    <video 
        class="auto-pause-video"  
        src="${post.video}" 
         loop   controls             
        controlsList="nodownload noplaybackrate"
        oncontextmenu="return false;"
        disablePictureInPicture
        style="-webkit-touch-callout:none; -webkit-user-select:none;
        user-select:none;" > 
        Your browser does not support the video tag.
    </video>
</div>`;
    } else if (post.image) {
        return `<div class="post-media"><img src="${post.image}" alt="Post image" loading="lazy"oncontextmenu="return false;"></div>`;
    }
    return '';
}

// Search functionality
function toggleSearchBar() {
    const searchBar = document.querySelector('.search-bar');
    if (searchBar) {
        searchBar.classList.toggle('active');
        if (searchBar.classList.contains('active')) {
            if (elements.searchInput) elements.searchInput.focus();
        }
    }
}

function handleSearch() {
    const query = elements.searchInput.value.trim().toLowerCase();
    
    if (query.length === 0) {
        if (elements.searchResults) {
            elements.searchResults.style.display = 'none';
        }
        return;
    }
    
    const searchResults = {
        profiles: searchProfiles(query),
        topics: searchTopics(query),
        posts: searchPosts(query)
    };
    
    displayEnhancedSearchResults(searchResults, query);
}

function searchProfiles(query) {
    const uniqueUsers = new Map();
    
    DATABASEPOSTS.forEach(post => {
        if (!uniqueUsers.has(post.username)) {
            const userPosts = DATABASEPOSTS.filter(p => p.username === post.username);
            const totalLikes = userPosts.reduce((sum, p) => sum + p.likes, 0);
            
            uniqueUsers.set(post.username, {
                name: post.name,
                username: post.username,
                postsCount: userPosts.length,
                totalLikes: totalLikes,
                type: 'profile'
            });
        }
    });
    
    return Array.from(uniqueUsers.values()).filter(user => 
        user.name.toLowerCase().includes(query) || 
        user.username.toLowerCase().includes(query)
    );
}

function searchTopics(query) {
    const topics = {};
    
    DATABASEPOSTS.forEach(post => {
        if (post.topic && post.topic.toLowerCase().includes(query)) {
            topics[post.topic] = (topics[post.topic] || 0) + 1;
        }
    });
    
    return Object.entries(topics)
        .map(([topic, count]) => ({
            name: `#${topic}`,
            topic: topic,
            postsCount: count,
            type: 'topic'
        }))
        .sort((a, b) => b.postsCount - a.postsCount);
}

function searchPosts(query) {
    return allPosts
        .filter(post => 
            (post.content && post.content.toLowerCase().includes(query)) ||
            (post.topic && post.topic.toLowerCase().includes(query))
        )
        .map(post => ({
            name: post.name,
            username: post.username,
            content: post.content ? post.content.substring(0, 100) + (post.content.length > 100 ? '...' : '') : '',
            datePost: post.datePost,
            likes: post.likes,
            type: 'post',
            postId: post.id
        }))
        .slice(0, 5);
}

function displayEnhancedSearchResults(results, query) {
    if (!elements.searchResults) return;
    
    const { profiles, topics, posts } = results;
    
    elements.searchResults.innerHTML = '';
    
    let hasResults = false;
    
    // Show profiles section
    if (profiles.length > 0) {
        hasResults = true;
        const profileSection = createSearchSection('Profiles', 'user');
        profiles.slice(0, 5).forEach(profile => {
            profileSection.appendChild(createProfileResultItem(profile));
        });
        elements.searchResults.appendChild(profileSection);
    }
    
    // Show topics section
    if (topics.length > 0) {
        hasResults = true;
        const topicSection = createSearchSection('Topics', 'hashtag');
        topics.slice(0, 5).forEach(topic => {
            topicSection.appendChild(createTopicResultItem(topic));
        });
        elements.searchResults.appendChild(topicSection);
    }
    
    // Show posts section
    if (posts.length > 0) {
        hasResults = true;
        const postSection = createSearchSection('Posts', 'file-alt');
        posts.forEach(post => {
            postSection.appendChild(createPostResultItem(post));
        });
        elements.searchResults.appendChild(postSection);
    }
    
    // Show no results message
    if (!hasResults) {
        const noResults = document.createElement('div');
        noResults.className = 'search-result-item';
        noResults.innerHTML = `
            <div style="text-align: center; padding: 1rem; color: var(--text-muted);">
                <i class="fas fa-search" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                <div>No results found for "${query}"</div>
            </div>
        `;
        elements.searchResults.appendChild(noResults);
    }
    
    elements.searchResults.style.display = 'block';
}

function createSearchSection(title, icon) {
    const section = document.createElement('div');
    section.className = 'search-section';
    section.innerHTML = `
        <div class="search-section-header">
            <i class="fas fa-${icon}"></i>
            <span>${title}</span>
        </div>
    `;
    return section;
}

function createProfileResultItem(profile) {
    const item = document.createElement('div');
    item.className = 'search-result-item';
    item.innerHTML = `
        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(profile.name)}&background=1e3a8a&color=fff" alt="${profile.name}">
        <div class="search-result-info">
            <h4>${profile.name}</h4>
            <span>@${profile.username}</span>
            <div class="search-result-meta">
                <span>${profile.postsCount} posts â€¢ ${profile.totalLikes.toLocaleString()} likes</span>
            </div>
        </div>
    `;
    
    item.addEventListener('click', () => {
        showUserProfile(profile.username, profile.name);
        addToSearchHistory(profile.username, profile.name, 'profile');
        if (elements.searchInput) elements.searchInput.value = '';
        if (elements.searchResults) elements.searchResults.style.display = 'none';
        document.querySelector('.search-bar')?.classList.remove('active');
    });
    
    return item;
}

function createTopicResultItem(topic) {
    const item = document.createElement('div');
    item.className = 'search-result-item';
    item.innerHTML = `
        <div class="topic-icon">
            <i class="fas fa-hashtag"></i>
        </div>
        <div class="search-result-info">
            <h4>${topic.name}</h4>
            <div class="search-result-meta">
                <span>${topic.postsCount} posts</span>
            </div>
        </div>
    `;
    
    item.addEventListener('click', () => {
        filterPostsByTopic(topic.topic);
        addToSearchHistory(topic.topic, topic.name, 'topic');
        if (elements.searchInput) elements.searchInput.value = '';
        if (elements.searchResults) elements.searchResults.style.display = 'none';
        document.querySelector('.search-bar')?.classList.remove('active');
    });
    
    return item;
}
function parseCustomDate(dateString) {
    try {
        // Parse "Dec 11 2025 3:02AM" format
        const months = {
            'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
            'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
        };
        
        // Split by space: ["Dec", "11", "2025", "3:02AM"]
        const parts = dateString.split(' ');
        
        if (parts.length < 4) {
            console.warn('Invalid date format:', dateString);
            return new Date(); // Return current date as fallback
        }
        
        const monthAbbr = parts[0];
        const day = parseInt(parts[1]);
        const year = parseInt(parts[2]);
        const timePart = parts[3];
        
        // Get month index
        const month = months[monthAbbr];
        if (month === undefined) {
            console.warn('Invalid month:', monthAbbr);
            return new Date();
        }
        
        // Parse time with AM/PM
        const timeMatch = timePart.match(/(\d+):(\d+)(AM|PM)/i);
        if (!timeMatch) {
            console.warn('Invalid time format:', timePart);
            return new Date(year, month, day);
        }
        
        let hours = parseInt(timeMatch[1]);
        const minutes = parseInt(timeMatch[2]);
        const ampm = timeMatch[3].toUpperCase();
        
        // Convert to 24-hour format
        if (ampm === 'PM' && hours < 12) {
            hours += 12;
        }
        if (ampm === 'AM' && hours === 12) {
            hours = 0;
        }
        
        return new Date(year, month, day, hours, minutes);
    } catch (error) {
        console.error('Error parsing date:', dateString, error);
        return new Date(); // Return current date as fallback
    }
}

function formatDateToCustom(date) {
    try {
        // Format: "Dec 11 2025 3:02AM"
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = months[date.getMonth()];
        const day = date.getDate();
        const year = date.getFullYear();
        
        // Format time to 12-hour format with AM/PM
        let hours = date.getHours();
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';
        
        // Convert to 12-hour format
        hours = hours % 12;
        hours = hours ? hours : 12; // Convert 0 to 12
        
        return `${month} ${day} ${year} ${hours}:${minutes}${ampm}`;
    } catch (error) {
        console.error('Error formatting date:', date, error);
        return 'Invalid Date';
    }
}

function formatJoinedDate(date) {
    try {
        // Format: "December 2025"
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${month} ${year}`;
    } catch (error) {
        console.error('Error formatting joined date:', date, error);
        return 'Recently';
    }
}


// Also update the search result date formatting:
function createPostResultItem(post) {
    const item = document.createElement('div');
    item.className = 'search-result-item';
    const postDate = parseCustomDate(post.datePost); // Use parser
    const formattedDate = formatDateToCustom(postDate); // Use the new format
    
    item.innerHTML = `
        <div class="post-icon">
            <i class="fas fa-file-alt"></i>
        </div>
        <div class="search-result-info">
            <h4>${post.name}</h4>
            <span>@${post.username} â€¢ ${formattedDate}</span>
            <div class="search-result-content">${post.content}</div>
            <div class="search-result-meta">
                <span><i class="fas fa-heart"></i> ${post.likes}</span>
            </div>
        </div>
    `;
    
    item.addEventListener('click', () => {
        scrollToPost(post.postId);
        addToSearchHistory(post.username, `Post by ${post.name}`, 'post');
        if (elements.searchInput) elements.searchInput.value = '';
        if (elements.searchResults) elements.searchResults.style.display = 'none';
        document.querySelector('.search-bar')?.classList.remove('active');
    });
    
    return item;
}

function showSearchResults() {
    if (elements.searchInput && elements.searchInput.value.trim().length > 0) {
        if (elements.searchResults) elements.searchResults.style.display = 'block';
    }
}

// Search history
function addToSearchHistory(identifier, name, type) {
    if (!currentUser) return;
    
    if (!currentUser.searchHistory) currentUser.searchHistory = [];
    
    const searchItem = { 
        identifier, 
        name, 
        type, 
        timestamp: new Date() 
    };
    
    // Remove if already exists
    currentUser.searchHistory = currentUser.searchHistory.filter(item => 
        !(item.identifier === identifier && item.type === type)
    );
    
    // Add to beginning
    currentUser.searchHistory.unshift(searchItem);
    
    // Keep only last 5 items
    currentUser.searchHistory = currentUser.searchHistory.slice(0, 5);
    
    saveCurrentUser();
    loadSearchHistory();
}

function loadSearchHistory() {
    if (!currentUser || !currentUser.searchHistory || !elements.searchHistory) return;
    
    elements.searchHistory.innerHTML = '';
    
    currentUser.searchHistory.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        
        let icon = 'history';
        if (item.type === 'profile') icon = 'user';
        if (item.type === 'topic') icon = 'hashtag';
        if (item.type === 'post') icon = 'file-alt';
        
        historyItem.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-${icon}" style="color: var(--text-muted);"></i>
                <div style="flex: 1; min-width: 0;">
                    <div style="color: var(--text-primary); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.name}</div>
                    <div style="color: var(--text-muted); font-size: 0.8rem; text-transform: capitalize;">${item.type}</div>
                </div>
            </div>
        `;
        
        historyItem.addEventListener('click', () => {
            if (item.type === 'profile') {
                showUserProfile(item.identifier, item.name);
            } else if (item.type === 'topic') {
                filterPostsByTopic(item.identifier);
            } else if (item.type === 'post') {
                scrollToPost(item.identifier);
            }
        });
        
        elements.searchHistory.appendChild(historyItem);
    });
}

function showUserProfile(username, name) {
    // Get user's posts
    const userPosts = DATABASEPOSTS.filter(post => post.username === username);
    
    if (userPosts.length === 0) return;
    
    // Calculate stats
    const totalLikes = userPosts.reduce((sum, post) => sum + post.likes, 0);
    const postsCount = userPosts.length;
    
    // Get followers count (simulated)
    const followers = Math.floor(totalLikes / 10) + 100;
    
    // Get following count (simulated)
    const following = Math.floor(postsCount * 2) + 50;
    
    // Get first post date
    const firstPost = userPosts[userPosts.length - 1];
    const joinedDate = firstPost ? formatJoinedDate(parseCustomDate(firstPost.datePost)) : 'Recently'; // Use parser
    
    // Update profile header
    const profileHeader = document.getElementById('profileHeader');
    if (profileHeader) {
        profileHeader.innerHTML = `
            <div class="profile-header">
                <div class="profile-avatar">
                    <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1e3a8a&color=fff" alt="${name}">
                </div>
                <h2 id="profileName">${name}</h2>
                <div class="profile-username">@${username}</div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value">${postsCount}</span>
                        <span class="stat-label">Posts</span>
                    </div>

                    <div class="stat-item">
                        <span class="stat-value">${totalLikes.toLocaleString()}</span>
                        <span class="stat-label">Total Likes</span>
                    </div>
                </div>
                <div class="joined-date">Joined ${joinedDate}</div>
            </div>
        `;
    }
    
    // Update profile name in modal header
    const profileNameElement = document.getElementById('profileName');
    if (profileNameElement) profileNameElement.textContent = name;
    
    // Load user's posts
    const profilePosts = document.getElementById('profilePosts');
    if (profilePosts) {
        profilePosts.innerHTML = '';
        
        // Show user's posts (newest first)
        const userPostsReversed = [...userPosts].reverse();
        userPostsReversed.forEach((post) => {
            // Find the post in allPosts to get correct ID
            const foundPost = allPosts.find(p => 
                p.username === post.username && 
                p.datePost === post.datePost
            );
            
            if (foundPost) {
                const postElement = createPostElement(foundPost, foundPost.id);
                profilePosts.appendChild(postElement);
            }
        });
    }
    
    // Show modal
    if (elements.profileModal) {
        elements.profileModal.classList.add('active');
    }
}
// Trending topics
function loadTrendingTopics() {
    const topics = {};
    
    // Count posts by topic
    DATABASEPOSTS.forEach(post => {
        if (post.topic) {
            topics[post.topic] = (topics[post.topic] || 0) + 1;
        }
    });
    
    // Sort topics by count
    const sortedTopics = Object.entries(topics)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
    
    if (elements.trendingList) {
        elements.trendingList.innerHTML = '';
        
        sortedTopics.forEach(([topic, count]) => {
            const topicItem = document.createElement('div');
            topicItem.className = 'trending-item';
            topicItem.innerHTML = `
                <div style="font-weight: 500; color: var(--text-primary);">#${topic}</div>
                <span>${count} posts</span>
            `;
            
            topicItem.addEventListener('click', () => {
                filterPostsByTopic(topic);
            });
            
            elements.trendingList.appendChild(topicItem);
        });
    }
}

function filterPostsByTopic(topic) {
    if (!elements.postsFeed) return;
    
    elements.postsFeed.innerHTML = '';
    currentPage = 0;
    displayedPosts.clear();
    
    // Filter and shuffle posts for this topic
    const filteredPosts = allPosts.filter(post => post.topic === topic);
    const shuffledPosts = shuffleArray([...filteredPosts], new Date().getTime());
    
    // Display filtered posts
    shuffledPosts.slice(0, postsPerPage).forEach(post => {
        const postElement = createPostElement(post, post.id);
        elements.postsFeed.appendChild(postElement);
        displayedPosts.add(post.id);
    });
    
    if (elements.loadMoreBtn) {
        elements.loadMoreBtn.style.display = 'none';
    }
}

// Suggested profiles
function loadSuggestedProfiles() {
    const uniqueUsers = new Map();
    
    DATABASEPOSTS.forEach(post => {
        if (!uniqueUsers.has(post.username)) {
            const userPosts = DATABASEPOSTS.filter(p => p.username === post.username);
            const totalLikes = userPosts.reduce((sum, p) => sum + p.likes, 0);
            
            uniqueUsers.set(post.username, {
                name: post.name,
                username: post.username,
                postsCount: userPosts.length,
                totalLikes: totalLikes
            });
        }
    });
    
    // Convert to array and sort by total likes
    const suggestedProfiles = Array.from(uniqueUsers.values())
        .sort((a, b) => b.totalLikes - a.totalLikes)
        .slice(0, 5);
    
    if (elements.suggestedProfiles) {
        elements.suggestedProfiles.innerHTML = '';
        
        suggestedProfiles.forEach(user => {
            const profileItem = document.createElement('div');
            profileItem.className = 'profile-item';
            profileItem.innerHTML = `
                <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=1e3a8a&color=fff" alt="${user.name}">
                <div class="profile-info">
                    <h4>${user.name}</h4>
                    <span>${user.postsCount} posts â€¢ ${user.totalLikes.toLocaleString()} likes</span>
                </div>
            `;
            
            profileItem.addEventListener('click', () => {
                showUserProfile(user.username, user.name);
            });
            
            elements.suggestedProfiles.appendChild(profileItem);
        });
    }
}

// Post creation functions
function showPostModal() {
    if (elements.postModal) {
        elements.postModal.classList.add('active');
    }
}

function handleMediaButtonClick(type) {
    currentMediaType = type;
    if (!elements.mediaPreview) return;
    
    elements.mediaPreview.innerHTML = '';
    elements.mediaPreview.classList.add('active');
    
    if (type === 'image') {
        if (elements.imageUpload) {
            elements.imageUpload.click();
            elements.imageUpload.onchange = handleImageUpload;
        }
    } else if (type === 'video') {
        if (elements.videoUpload) {
            elements.videoUpload.click();
            elements.videoUpload.onchange = handleVideoUpload;
        }
    } else if (type === 'iframe') {
        elements.mediaPreview.innerHTML = `
            <input type="text" id="linkInputInline" placeholder="Paste YouTube/Facebook link" 
                   style="width: 100%; padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary);">
            <button id="processLinkBtn" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--accent); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                Add Link
            </button>
        `;
        
        const processBtn = document.getElementById('processLinkBtn');
        if (processBtn) {
            processBtn.addEventListener('click', processLink);
        }
    }
}

function handleImageUpload(e) {
    const file = e.target.files[0];
    if (file && elements.mediaPreview) {
        const reader = new FileReader();
        reader.onload = (e) => {
            elements.mediaPreview.innerHTML = `
                <img src="${e.target.result}" alt="Preview" style="max-width: 100%; border-radius: 0.5rem;">
                <div style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                    Image ready to post
                </div>
            `;
        };
        reader.readAsDataURL(file);
    }
}

function handleVideoUpload(e) {
    const file = e.target.files[0];
    if (file && elements.mediaPreview) {
        elements.mediaPreview.innerHTML = `
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                Video file selected: ${file.name}
            </div>
        `;
    }
}

function processLink() {
    const linkInput = document.getElementById('linkInputInline');
    if (!linkInput || !elements.mediaPreview) return;
    
    const link = linkInput.value.trim();
    
    if (!link) return;
    
    // Convert YouTube shorts links to embed links
    let embedLink = link;
    
    // Handle YouTube shorts
    if (link.includes('youtube.com/shorts/')) {
        const videoId = link.match(/shorts\/([^?]+)/)[1];
        embedLink = `https://www.youtube.com/embed/${videoId}`;
    }
    // Handle youtu.be links
    else if (link.includes('youtu.be/')) {
        const videoId = link.match(/youtu\.be\/([^?]+)/)[1];
        embedLink = `https://www.youtube.com/embed/${videoId}`;
    }
    // Handle regular YouTube links
    else if (link.includes('youtube.com/watch')) {
        const videoId = new URL(link).searchParams.get('v');
        if (videoId) {
            embedLink = `https://www.youtube.com/embed/${videoId}`;
        }
    }
    
    elements.mediaPreview.innerHTML = `
        <div style="color: var(--text-secondary); font-size: 0.9rem;">
            Link processed: ${embedLink.includes('youtube.com/embed') ? 'YouTube' : 'External'} link
        </div>
    `;
}

function createPost() {
    if (!elements.postContent) return;
    
    const content = elements.postContent.value.trim();
    const topic = elements.postTopic ? elements.postTopic.value.trim() : '';
    
    // Check if there's at least one content type
    const hasMedia = elements.mediaPreview && 
                     elements.mediaPreview.classList.contains('active') && 
                     elements.mediaPreview.innerHTML.trim() !== '';
    
    if (!content && !hasMedia) {
        alert('Please add some content to your post!');
        return;
    }
    
    // In a real app, this would send to a server
    alert('Post functionality requires backend integration. In a real app, this would save to database.');
    
    // Reset form
    if (elements.postContent) elements.postContent.value = '';
    if (elements.postTopic) elements.postTopic.value = '';
    if (elements.mediaPreview) {
        elements.mediaPreview.classList.remove('active');
        elements.mediaPreview.innerHTML = '';
    }
    currentMediaType = null;
}

function addMediaToPost(type) {
    if (!elements.mediaPreviewModal) return;
    
    elements.mediaPreviewModal.innerHTML = '';
    
    if (type === 'image') {
        elements.mediaPreviewModal.innerHTML = `
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                Image upload would be implemented here
            </div>
        `;
    } else if (type === 'video') {
        elements.mediaPreviewModal.innerHTML = `
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                Video upload would be implemented here
            </div>
        `;
    } else if (type === 'iframe') {
        elements.mediaPreviewModal.innerHTML = `
            <input type="text" id="linkInputModal" placeholder="Paste YouTube/Facebook link" 
                   style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary);">
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                Supports: youtube.com, youtu.be, youtube.com/shorts
            </div>
        `;
    }
}

function createNewPost() {
    if (!elements.postContentModal) return;
    
    const content = elements.postContentModal.value.trim();
    const topic = elements.postTopicModal ? elements.postTopicModal.value.trim() : '';
    
    if (!content) {
        alert('Please add some content to your post!');
        return;
    }
    
    // In a real app, this would be sent to a server
    alert(`Post created successfully!\n\nNote: In a real app, this would be saved to the database.`);
    
    // Reset form and close modal
    resetPostForm();
    if (elements.postModal) {
        elements.postModal.classList.remove('active');
    }
}

function resetPostForm() {
    if (elements.postContentModal) elements.postContentModal.value = '';
    if (elements.postTopicModal) elements.postTopicModal.value = '';
    if (elements.mediaPreviewModal) elements.mediaPreviewModal.innerHTML = '';
}
// Add sound functions at the top of your main.js (after global variables)
function playLikeSound() {
    try {
        // Create a simple beep sound for like
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 523.25; // C5 note (pleasant sound)
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
    } catch (error) {
        console.log('Audio context not supported, using fallback sound');
        // Fallback: Use HTML5 audio if available
        playFallbackSound('like');
    }
}

function playUnlikeSound() {
    try {
        // Create a different sound for unlike
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 392.00; // G4 note (lower, softer sound)
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
    } catch (error) {
        console.log('Audio context not supported, using fallback sound');
        // Fallback: Use HTML5 audio if available
        playFallbackSound('unlike');
    }
}

function playFallbackSound(type) {
    try {
        // Create simple beep using Web Audio API fallback
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        
        oscillator.connect(audioContext.destination);
        oscillator.frequency.value = type === 'like' ? 600 : 400;
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.1);
    } catch (error) {
        // Last resort: Use a div click sound simulation
        console.log('Playing simulated sound');
    }
}
// Update the handleLike function
function handleLike(postId, button) {
    if (!currentUser || currentUser.isGuest) {
        alert('Please login to like posts!');
        return;
    }
    
    const post = allPosts.find(p => p.id === postId);
    if (!post) return;
    
    if (!currentUser.likedPosts) currentUser.likedPosts = new Set();
    
    // Get the post element first to get current displayed likes
    const postElement = button.closest('.post-card');
    const likesSpan = postElement.querySelector('.post-stats span:first-child');
    
    // Parse current likes from the DOM (this is the actual displayed value)
    let currentLikes = post.likes;
    if (likesSpan) {
        const likesText = likesSpan.textContent;
        currentLikes = parseInt(likesText.replace(/[^0-9]/g, ''));
    }
    
    if (currentUser.likedPosts.has(postId)) {
        // Unlike
        currentUser.likedPosts.delete(postId);
        currentLikes--;
        button.classList.remove('liked');
        button.innerHTML = '<i class="fas fa-heart"></i> Like';
        
        // Play unlike sound
        playUnlikeSound();
        
    } else {
        // Like
        currentUser.likedPosts.add(postId);
        currentLikes++;
        button.classList.add('liked');
        button.innerHTML = '<i class="fas fa-heart"></i> Liked';
        
        // Play like sound
        playLikeSound();
        
        // Add a subtle animation
        button.style.transform = 'scale(1.2)';
        setTimeout(() => {
            button.style.transform = 'scale(1)';
        }, 200);
    }
    
    // Update the post object
    post.likes = currentLikes;
    
    // Update likes count in post stats
    if (likesSpan) {
        likesSpan.textContent = `${currentLikes.toLocaleString()} likes`;
        
        // Add animation to likes count
        likesSpan.style.color = 'var(--accent)';
        setTimeout(() => {
            likesSpan.style.color = '';
        }, 300);
    }
    
    // Save user data if logged in
    saveCurrentUser();
}
// Scroll to post
function scrollToPost(postId) {
    const postElement = document.querySelector(`[data-post-id="${postId}"]`);
    if (postElement) {
        // Highlight the post temporarily
        postElement.style.boxShadow = '0 0 0 3px var(--accent)';
        postElement.style.transition = 'box-shadow 0.3s';
        setTimeout(() => {
            postElement.style.boxShadow = '';
        }, 2000);
        
        postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

// Mobile menu functions
function openMobileMenu() {
    if (elements.mobileMenu) {
        elements.mobileMenu.classList.add('active');
    }
}

function closeMobileMenu() {
    if (elements.mobileMenu) {
        elements.mobileMenu.classList.remove('active');
    }
}

function toggleUserMenu() {
    if (elements.userMenu) {
        elements.userMenu.classList.toggle('active');
    }
}

// Theme handling
function setupTheme() {
    const savedTheme = localStorage.getItem('meko-theme');
    if (savedTheme === 'light') {
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
        if (elements.themeIcon) {
            elements.themeIcon.className = 'fas fa-sun';
        }
    }
}
// main.js - Add this function
function showOwnProfile() {
    if (!currentUser || currentUser.isGuest) {
        alert('Please login to view your profile!');
        return;
    }
    
    // Get logged-in user's posts from DATABASEPOSTS
    const userPosts = DATABASEPOSTS.filter(post => post.username === currentUser.username);
    
    if (userPosts.length === 0) {
        // User has no posts yet, but still show profile
        showUserProfile(currentUser.username, currentUser.name);
        return;
    }
    
    // Show the user's profile
    showUserProfile(currentUser.username, currentUser.name);
}

// Update showUserProfile to show mentions section
function showUserProfile(username, name) {
    const userPosts = DATABASEPOSTS.filter(post => post.username === username);
    const totalLikes = userPosts.reduce((sum, post) => sum + post.likes, 0);
    const postsCount = userPosts.length;
    
    // Get mentions for this user
    const userMentions = getMentionsForUser(username);
    const firstPost = userPosts[userPosts.length - 1];
    const joinedDate = firstPost ? formatJoinedDate(parseCustomDate(firstPost.datePost)) : 'Recently';
    
    const profileHeader = document.getElementById('profileHeader');
    if (profileHeader) {
        profileHeader.innerHTML = `
            <div class="profile-header">
                <div class="profile-avatar">
                    <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1e3a8a&color=fff" alt="${name}">
                </div>
                <h2 id="profileName">${name}</h2>
                <div class="profile-username">@${username}</div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value">${postsCount}</span>
                        <span class="stat-label">Posts</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${totalLikes.toLocaleString()}</span>
                        <span class="stat-label">Total Likes</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${userMentions.length}</span>
                        <span class="stat-label">Mentions</span>
                    </div>
                </div>
                <div class="joined-date">Joined ${joinedDate}</div>
            </div>
        `;
    }
    
    const profileNameElement = document.getElementById('profileName');
    if (profileNameElement) profileNameElement.textContent = name;
    
    const profilePosts = document.getElementById('profilePosts');
    if (profilePosts) {
        profilePosts.innerHTML = '';
        
        // Create tabs for posts and mentions
        profilePosts.innerHTML = `
            <div class="profile-tabs">
                <button class="profile-tab active" data-tab="posts">Posts (${postsCount})</button>
                <button class="profile-tab" data-tab="mentions">Mentions (${userMentions.length})</button>
            </div>
            <div class="profile-content">
                <div class="tab-content active" id="postsTab">
                    <!-- Posts will be loaded here -->
                </div>
                <div class="tab-content" id="mentionsTab">
                    <!-- Mentions will be loaded here -->
                </div>
            </div>
        `;
        
        // Load posts
        const postsTab = document.getElementById('postsTab');
        if (userPosts.length > 0) {
            const userPostsReversed = [...userPosts].reverse();
            userPostsReversed.forEach((post) => {
                const foundPost = allPosts.find(p => 
                    p.username === post.username && 
                    p.datePost === post.datePost
                );
                
                if (foundPost) {
                    const postElement = createPostElement(foundPost, foundPost.id);
                    postsTab.appendChild(postElement);
                }
            });
        } else {
            postsTab.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-newspaper"></i>
                    <h3>No posts yet</h3>
                    <p>This user hasn't posted anything yet.</p>
                </div>
            `;
        }
        
        // Load mentions
        const mentionsTab = document.getElementById('mentionsTab');
        if (userMentions.length > 0) {
            userMentions.forEach(mention => {
                const foundPost = allPosts.find(p => p.id === mention.postId);
                if (foundPost) {
                    const postElement = createPostElement(foundPost, mention.postId);
                    mentionsTab.appendChild(postElement);
                }
            });
        } else {
            mentionsTab.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-at"></i>
                    <h3>No mentions yet</h3>
                    <p>This user hasn't been mentioned yet.</p>
                </div>
            `;
        }
        
        // Add tab switching
        document.querySelectorAll('.profile-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                // Update active tab
                document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}Tab`).classList.add('active');
            });
        });
    }
    
    if (elements.profileModal) {
        elements.profileModal.classList.add('active');
    }
}
function toggleTheme() {
    if (document.body.classList.contains('dark-mode')) {
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
        if (elements.themeIcon) {
            elements.themeIcon.className = 'fas fa-sun';
        }
        localStorage.setItem('meko-theme', 'light');
    } else {
        document.body.classList.remove('light-mode');
        document.body.classList.add('dark-mode');
        if (elements.themeIcon) {
            elements.themeIcon.className = 'fas fa-moon';
        }
        localStorage.setItem('meko-theme', 'dark');
    }
}

// Initialize the app when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    // DOM is already loaded
    init();
}
</script>

<script>
// --- GLOBAL INTERSECTION OBSERVER SETUP ---

const videoObserverOptions = {
    root: null, // Use the viewport
    rootMargin: '0px',
    threshold: [0.0, 0.25, 0.5, 0.75, 1.0] // Check intersection at multiple points
};

const videoObserverCallback = (entries) => {
    entries.forEach(entry => {
        const video = entry.target;

        if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
            // AUTO-PLAY: Video is 50% or more visible.
            if (video.paused) {
                // Check if video is loaded and attempt to play
                video.play().catch(error => {
                    // Log error if autoplay is blocked (e.g., if 'muted' was somehow missed)
                    console.warn("Autoplay blocked for video:", video.src, error);
                });
            }
        } else {
            // AUTO-PAUSE: Video is less than 50% visible (scrolled away)
            if (!video.paused) {
                video.pause();
            }
        }
    });
};

const postVideoObserver = new IntersectionObserver(videoObserverCallback, videoObserverOptions);

// --- END GLOBAL INTERSECTION OBSERVER SETUP ---

</script>
</body>
</html>
